<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Principal</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.16/dist/tailwind.min.css" rel="stylesheet">
    <script src="./src/main/resources/templates/search.js"></script>
    <style>
        .galeria-imagens img {
            max-width: 100%;
            height: 350px;
            margin-right: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.8
            ), 0 4px 6px -4px rgb(0 0 0 / 0.8
            );
        }

        .gallery-container {
            width: auto;
            margin-bottom: 10px;
            min-height: 300px;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin-top: 50px;
            border-width: 8px;

            background-color: #EAEAEA;
            border-color: #EAEAEA;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.300);
        }

        .gallery-title {
            padding: 10px;
            text-align: center;
            margin-left: 10px;
            margin-bottom: 10px;
            font-family: "Bodoni MT";
            font-size: 42px;
            font-weight: bold;
            border-radius: 50px;
            outline:  #EAEAEA;
            color: #555555;

        }

        .btn-delete {
            position: absolute;
            top: 5px;
            right: 15px;
            padding: 10px;
            font-family: "Bodoni MT";
            font-size: 20px;
            font-weight: bold;
            outline:  #EAEAEA;
            color: #555555;
        }

        .image-thumbnail {
            width: 260px;
            height: auto;
            border-radius: 10px;
        }

        .search-container {
            position: absolute;
            top: 85px;
            right: 20px;
            display: flex;
            align-items: center;
            right: 25px;
        }

        .buttons-container {
            position: absolute;
            top: 85px;
            left: 25px;
            display: flex;
            align-items: center;
            right: 25px;
        }

        .search-input {
            margin-left: 300px;

        }

        .search-button {
            margin-left: 4px;
        }

        .navcolor{
            background-color: white;
        }

        .fundo{
            background:white;
        }
        .altura{
            margin-top: -37px;
        }


    </style>
    <script>
        function showSection(sectionId) {
            console.log('sectionId:', sectionId);

            var sections = document.querySelectorAll('.content-section');
            sections.forEach(function (section) {
                section.style.display = 'none';
            });
            var selectedSection = document.getElementById(sectionId);
            if (selectedSection) {
                selectedSection.style.display = 'block';
            } else {
                console.error('Elemento não encontrado com ID:', sectionId);
            }
        }

        async function excluirGaleria(id) {
            try {
                const response = await fetch(`/api/delete/${id}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    carregarGalerias();
                } else {
                    console.error('Falha ao excluir galeria:', response.status, response.statusText);
                }
            } catch (error) {
                console.error('Erro inesperado ao excluir galeria:', error);
            }
        }

        async function carregarGaleriasUsuario() {
            const response = await fetch('/api/galleryList');
            const galeriasUsuario = await response.json();

            const dropdown = document.getElementById('galeriaDropdown');

            galeriasUsuario.forEach(galeria => {
                const option = document.createElement('option');
                option.value = galeria.id;
                option.textContent = galeria.title;
                dropdown.appendChild(option);
            });
        }
        carregarGaleriasUsuario();

        document.addEventListener('DOMContentLoaded', function () {
            var btnCadastrarFoto = document.getElementById('btnCadastrarFoto');
            btnCadastrarFoto.addEventListener('click', function () {
            });
        });
        document.addEventListener('DOMContentLoaded', function () {
            var btnCadastrarFoto = document.getElementById('btnCadastrarFoto');
            var modal = document.getElementById('modal');

            btnCadastrarFoto.addEventListener('click', function () {
                modal.classList.remove('hidden');
            });

            modal.addEventListener('click', function (event) {
                if (event.target === modal) {
                    modal.classList.add('hidden');
                }
            });
        });

        function limparGalerias() {
            const galeriasDiv = document.getElementById('galerias');
            galeriasDiv.innerHTML = '';
        }

        async function carregarGalerias() {
            limparGalerias();
            const response = await fetch('/api/galleryList');
            const galerias = await response.json();

            const galeriasDiv = document.getElementById('galerias');
            galeriasDiv.innerHTML = '';

            for (const galeria of galerias) {
                const galeriaContainer = document.createElement('div');
                galeriaContainer.classList.add('gallery-container', 'border', 'border-white-500','border-8', 'border-sky-500', 'p-4', 'rounded-lg', 'mb-4', 'flex', 'flex-col');

                const headerDiv = document.createElement('div');
                headerDiv.classList.add('flex', 'justify-between');

                const galeriaTitle = document.createElement('div');
                galeriaTitle.textContent = galeria.title;
                galeriaTitle.classList.add('gallery-title', 'text-lg', 'font-semibold', 'mb-2', 'text-center');
                headerDiv.appendChild(galeriaTitle);

                const btnExcluir = document.createElement('button');

                btnExcluir.textContent = 'Excluir';
                btnExcluir.classList.add('btn-delete', 'text-lg', 'font-semibold', 'mb-2', 'text-center');

                btnExcluir.addEventListener('click', () => {
                    const id = galeria.id;
                    if (typeof id === 'number') {
                        excluirGaleria(id);
                    } else {
                        console.error('ID inválido:', id);
                    }
                });
                headerDiv.appendChild(btnExcluir);

                galeriaContainer.appendChild(headerDiv);

                const imagensDiv = document.createElement('div');
                imagensDiv.classList.add('galeria-imagens', 'flex', 'flex-wrap', 'justify-center');
                galeriaContainer.appendChild(imagensDiv);

                const responseImagens = await fetch(`/api/galleryImages/${galeria.id}`);
                const images = await responseImagens.json();

                images.forEach(imageData => {
                    const imageElement = document.createElement('img');
                    imageElement.src = `data:image/png;base64,${imageData}`;
                    imageElement.classList.add('image-thumbnail');

                    imagensDiv.appendChild(imageElement);
                });

                galeriasDiv.appendChild(galeriaContainer);
            }
        }

        carregarGalerias();

        document.addEventListener('DOMContentLoaded', function () {
            const modalGaleria = document.getElementById('modalGaleria');
            const btnAbrirModal = document.getElementById('btnCriarGaleria');
            const formularioCriarGaleria = document.getElementById('formularioCriarGaleria');
            const tituloGaleriaInput = document.getElementById('title');
            const galeriasDiv = document.getElementById('galerias');
            const galeriaDropdown = document.getElementById('galeriaDropdown');

            btnAbrirModal.addEventListener('click', function () {
                modalGaleria.style.display = 'block';
            });
            modalGaleria.addEventListener('click', function (event) {
                if (event.target === modalGaleria) {
                    modalGaleria.style.display = 'none';
                }
            });

            formularioCriarGaleria.addEventListener('submit', function (event) {
                event.preventDefault();
                const tituloGaleria = tituloGaleriaInput.value;

                fetch('/create-gallery', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ title: tituloGaleria }),
                })
                    .then(response => response.json())
                    .then(data => {

                        const headerDiv = document.createElement('div');
                        headerDiv.classList.add('flex', 'justify-between');

                        const galeriaElement = document.createElement('div');
                        galeriaElement.textContent = data.titulo;
                        galeriaElement.classList.add('gallery-title', 'text-lg', 'font-semibold', 'mb-2', 'text-center');
                        headerDiv.appendChild(galeriaElement);

                        const galeriaContainer = document.createElement('div');
                        galeriaContainer.classList.add('gallery-container', 'border', 'border-white-500', 'border-8', 'border-sky-500', 'p-4', 'rounded-lg', 'mb-4', 'flex', 'flex-col');
                        galeriaContainer.appendChild(galeriaElement);
                        galeriasDiv.appendChild(galeriaContainer);

                        const btnExcluir = document.createElement('button');
                        btnExcluir.textContent = 'Excluir';
                        btnExcluir.classList.add('btn-delete', 'text-lg', 'font-semibold', 'mb-2', 'text-center');

                        fetch(`/api/galleryIdByTitle/${data.titulo}`)
                            .then(response => response.json())
                            .then(idData => {
                                const id = idData.id;
                                if (typeof id === 'number') {
                                    btnExcluir.addEventListener('click', () => {
                                        excluirGaleria(id);
                                    });
                                } else {
                                    console.error('ID inválido:', id);
                                }
                            })
                            .catch(error => {
                                console.error('Erro ao buscar a ID da galeria:', error);
                            });

                        headerDiv.appendChild(btnExcluir);
                        galeriasDiv.appendChild(headerDiv);

                        tituloGaleriaInput.value = '';
                        modalGaleria.style.display = 'none';

                    })
                    .catch(error => {
                        console.error('Erro ao criar galeria:', error);
                    });
            });
        });

        function exibirGalerias(galerias) {
            const galeriasDiv = document.getElementById('galerias');
            galeriasDiv.innerHTML = '';

            galerias.forEach(async (galeria) => {
                const galeriaContainer = document.createElement('div');
                galeriaContainer.classList.add('gallery-container', 'border', 'border-white-500', 'border-8', 'border-sky-500', 'p-4', 'rounded-lg', 'mb-4', 'flex', 'flex-col');

                const headerDiv = document.createElement('div');
                headerDiv.classList.add('flex', 'justify-between')

                const galeriaTitle = document.createElement('div');
                galeriaTitle.textContent = galeria.title;
                galeriaTitle.classList.add('gallery-title', 'text-lg', 'font-semibold', 'mb-2', 'text-center');
                galeriaContainer.appendChild(galeriaTitle);

                const btnExcluir = document.createElement('button');
                btnExcluir.textContent = 'Excluir';
                btnExcluir.classList.add('btn-delete', 'text-lg', 'font-semibold', 'mb-2', 'text-center');

                btnExcluir.addEventListener('click', () => {
                    const id = galeria.id;
                    if (typeof id === 'number') {
                        excluirGaleria(id);
                    } else {
                        console.error('ID inválido:', id);
                    }
                });
                headerDiv.appendChild(btnExcluir);

                const imagensDiv = document.createElement('div');
                imagensDiv.classList.add('galeria-imagens', 'flex', 'flex-wrap', 'justify-center');
                galeriaContainer.appendChild(imagensDiv);

                const responseImagens = await fetch(`/api/galleryImages/${galeria.id}`);
                const images = await responseImagens.json();

                images.forEach(imageData => {
                    const imageElement = document.createElement('img');
                    imageElement.src = `data:image/png;base64,${imageData}`;
                    imageElement.classList.add('image-thumbnail');

                    imagensDiv.appendChild(imageElement);
                });

                galeriasDiv.appendChild(galeriaContainer);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const form = document.querySelector('form');
            const galeriasDiv = document.getElementById('galerias');

            form.addEventListener('submit', function (event) {
                event.preventDefault();

                const searchInput = document.getElementById('search');
                const title = searchInput.value;

                const searchData = { title };

                fetch('/api/filter', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(searchData)
                })
                    .then(response => response.json())
                    .then(data => {
                        exibirGalerias(data);
                    })
                    .catch(error => {
                        console.error('Erro ao buscar galerias:', error);
                    });
            });
            carregarGalerias();
        });
    </script>
</head>

<body class="fundo">

<nav
        class="navcolor relative flex w-full flex-wrap items-center justify-between bg-[#FBFBFB] py-2 text-neutral-500 shadow-lg hover:text-neutral-700 focus:text-neutral-700 dark:bg-neutral-600 lg:py-4">
    <div class="flex w-full flex-wrap items-center justify-between px-3">
        <nav class="w-full rounded-md" aria-label="breadcrumb">
            <ol class="list-reset ml-2 flex">
                <li>
                    <a href="javascript:void(0);" onclick="showSection('home');"
                       class="text-neutral-500 transition duration-200 hover:text-neutral-600 hover:ease-in-out motion-reduce:transition-none dark:text-neutral-200">Home</a>
                </li>
                <li>
                    <span class="mx-2 text-neutral-500 dark:text-neutral-200">/</span>
                </li>
                <li>
                    <a href="javascript:void(0);" onclick="showSection('galeria');"
                       class="text-neutral-500 transition duration-200 hover:text-neutral-600 hover:ease-in-out motion-reduce:transition-none dark:text-neutral-200">Galerias</a>
                </li>
                <li>
                    <span class="mx-2 text-neutral-500 dark:text-neutral-200">/</span>
                </li>
                <li>
                    <a href="javascript:void(0);" onclick="showSection('perfil');"
                       class="text-neutral-500 transition duration-200 hover:text-neutral-600 hover:ease-in-out motion-reduce:transition-none dark:text-neutral-200">Perfil</a>
                </li>
                <li>
                    <span class="mx-2 text-neutral-500 dark:text-neutral-200">/</span>
                </li>
                <li>
                    <a href="javascript:void(0);" onclick="showSection('contato');"
                       class="text-neutral-500 transition duration-200 hover:text-neutral-600 hover:ease-in-out motion-reduce:transition-none dark:text-neutral-200">Contato</a>
                </li>
            </ol>
        </nav>
    </div>
</nav>

<div id="galeria" class="content-section hidden">
    <div class="p-16 altura">
        <form action="/api/filter" method="post">
            <div class="search-container">
                <input type="text" id="search" name="search"
                       class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow"
                       placeholder="Buscar">
                <button id="btnBuscar" type="submit"
                        class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow">Buscar</button>
            </div>
        </form>


        <button id="btnCadastrarFoto"
                class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow">Nova
            foto</button>

        <button id="btnCriarGaleria"
                class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow">Criar
            galeria</button>


        <div id="modalContainer"></div>

        <div id="galerias"></div>

    </div>
</div>
<div id="modalGaleria" class="fixed inset-0 flex items-center justify-center hidden">
    <div class="bg-white p-8 rounded-md shadow-lg">
        <form action="/create-gallery" method="post" id="formularioCriarGaleria">
            <div class="mb-4">
                <h2 class="text-lg font-semibold mb-2">Criar Nova Galeria</h2>
                <label for="title" class="block text-sm font-medium text-gray-700">Título da Galeria</label>
                <input type="text" id="title" name="title" class="mt-1 p-2 w-full border rounded-md">
            </div>
            <div class="flex justify-end">
                <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Criar
                    Galeria</button>
            </div>
        </form>
    </div>
</div>

<div id="modal" class="fixed inset-0 flex items-center justify-center hidden">
    <div class="bg-white p-8 rounded-md shadow-lg">

        <form action="/register-Image" method="post" id="formularioCadastroFoto" enctype="multipart/form-data">
            <div class="mb-4">
                <label for="identification"
                       class="block text-sm font-medium text-gray-700">Identification</label>
                <input type="text" id="identification" name="identification"
                       class="mt-1 p-2 w-full border rounded-md">
            </div>
            <div class="mb-4">
                <label for="description" class="block text-sm font-medium text-gray-700">Description</label>
                <input type="text" id="description" name="description"
                       class="mt-1 p-2 w-full border rounded-md">
            </div>
            <div class="mb-4">
                <label for="galeriaDropdown" class="block text-sm font-medium text-gray-700">Selecione a
                    galeria</label>
                <select id="galeriaDropdown" name="galeriaId"
                        class="mt-1 p-2 w-full border rounded-md"></select>
            </div>
            <div class="mb-4">
                <label for="image" class="block text-sm font-medium text-gray-700">Image</label>
                <input type="file" id="image" name="image" accept="image/*" class="mt-1">
            </div>
            <div class="flex justify-end">
                <button type="submit"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Register</button>
            </div>
        </form>
    </div>
</div>

<div id="home" class="content-section hidden">
    <div class="bg-gray-100 p-8">
        <h1>Entre em Contato</h1>
        <p>Preencha o formulário abaixo para entrar em contato conosco.</p>
    </div>
</div>
<div id="perfil" class="content-section hidden">
    <div class="bg-gray-100 p-8">
    </div>

</div>
<div id="contato" class="content-section hidden">
    <h1>teste</h1>
</div>
</div>
</body>

</html>